<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Space Defender</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            font-family: 'Arial', sans-serif;
            color: white;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            width: 800px;
            text-align: center;
        }
        #game-canvas {
            border: 2px solid #4a47a3;
            border-radius: 8px;
            background-color: #0a0a2a;
            box-shadow: 0 0 20px rgba(74, 71, 163, 0.5);
        }
        #game-ui { display:flex; justify-content:space-between; margin-bottom:10px; }
        #score,#lives { font-size:20px; font-weight:bold; text-shadow:0 0 5px #4a47a3; }
        #start-screen,#game-over {
            position:absolute; top:0; left:0; width:100%; height:100%;
            display:flex; flex-direction:column; justify-content:center; align-items:center;
            background-color: rgba(10,10,42,0.8); border-radius:8px;
        }
        #game-over { display:none; }
        h1 { color:#4a47a3; font-size:48px; margin-bottom:20px; text-shadow:0 0 10px #4a47a3; }
        h2 { color:#ff6b6b; font-size:36px; margin-bottom:20px; }
        button {
            background: linear-gradient(to bottom,#4a47a3,#302b63); color:white; border:none;
            padding:12px 30px; font-size:18px; border-radius:30px; cursor:pointer; margin-top:20px;
            box-shadow:0 0 15px rgba(74,71,163,0.7); transition: all 0.3s ease;
        }
        button:hover { transform:scale(1.05); box-shadow:0 0 20px rgba(74,71,163,0.9); }
        .instructions { margin-top:20px; max-width:80%; line-height:1.5; }
        .controls { display:flex; justify-content:center; gap:40px; margin-top:20px; }
        .control-item { text-align:center; }
        .key { display:inline-block; background-color:#4a47a3; padding:5px 10px; border-radius:5px; margin:0 5px; box-shadow:0 0 5px rgba(74,71,163,0.7); }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-ui">
            <div id="score">Score: 0</div>
            <div id="lives">Lives: 3</div>
        </div>
        <canvas id="game-canvas" width="800" height="500"></canvas>

        <div id="start-screen">
            <h1>SPACE DEFENDER</h1>
            <p class="instructions">Defend your space from incoming asteroids! Shoot them before they reach the bottom.</p>
            <div class="controls">
                <div class="control-item"><p>Move: <span class="key">←</span> <span class="key">→</span></p></div>
                <div class="control-item"><p>Shoot: <span class="key">Space</span></p></div>
            </div>
            <button id="start-button">START GAME</button>
        </div>

        <div id="game-over">
            <h2>GAME OVER</h2>
            <p id="final-score">Your score: 0</p>
            <button id="restart-button">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        // Elements
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const scoreDisplay = document.getElementById('score');
        const livesDisplay = document.getElementById('lives');
        const finalScoreDisplay = document.getElementById('final-score');

        // State
        let gameActive = false;
        let score = 0;
        let lives = 3;

        const player = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 60,
            width: 50, height: 50,
            speed: 7,
            color: '#4a47a3'
        };

        let bullets = [];
        let asteroids = [];
        let particles = [];
        const keys = {};

        // Input
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if ((e.key === ' ' || e.code === 'Space') && gameActive) shoot();
        });
        window.addEventListener('keyup', (e) => keys[e.key] = false);
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);

        // Game control
        function startGame() {
            if (gameActive) return; // guard against double-start
            gameActive = true;
            score = 0;
            lives = 3;
            bullets = [];
            asteroids = [];
            particles = [];
            player.x = canvas.width / 2 - 25;
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            updateScore();
            updateLives();
            asteroidSpawner();
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameActive = false;
            finalScoreDisplay.textContent = `Your score: ${score}`;
            gameOverScreen.style.display = 'flex';
        }

        function updateScore(){ scoreDisplay.textContent = `Score: ${score}`; }
        function updateLives(){ livesDisplay.textContent = `Lives: ${lives}`; }

        function shoot(){
            bullets.push({
                x: player.x + player.width / 2 - 2,
                y: player.y,
                width: 4, height: 15, speed: 10
            });
        }

        function asteroidSpawner(){
            if (!gameActive) return;
            const size = Math.random() * 30 + 20;
            asteroids.push({
                x: Math.random() * (canvas.width - size),
                y: -size, width: size, height: size,
                speed: Math.random() * 2 + 1
            });
            const nextSpawn = Math.random() * 1000 + 500;
            setTimeout(asteroidSpawner, nextSpawn);
        }

        function createParticles(x,y,color,count){
            for(let i=0;i<count;i++){ 
                particles.push({
                    x,y,
                    size: Math.random()*3+1,
                    speedX: Math.random()*4-2,
                    speedY: Math.random()*4-2,
                    color, life: 30
                });
            }
        }

        function update(){
            if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
            if (keys['ArrowRight'] || keys['d']) player.x += player.speed;
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            for (let i = bullets.length - 1; i >= 0; i--){
                bullets[i].y -= bullets[i].speed;
                if (bullets[i].y + bullets[i].height < 0) bullets.splice(i,1);
            }

            for (let i = asteroids.length - 1; i >= 0; i--){
                asteroids[i].y += asteroids[i].speed;
                if (asteroids[i].y > canvas.height){
                    asteroids.splice(i,1);
                    lives--; updateLives();
                    if (lives <= 0) gameOver();
                }
            }

            for (let i = asteroids.length - 1; i >= 0; i--){
                for (let j = bullets.length - 1; j >= 0; j--){
                    const a = asteroids[i], b = bullets[j];
                    if (b.x < a.x + a.width && b.x + b.width > a.x && b.y < a.y + a.height && b.y + b.height > a.y){
                        createParticles(a.x + a.width/2, a.y + a.height/2, '#ff6b6b', 10);
                        asteroids.splice(i,1);
                        bullets.splice(j,1);
                        score += 10; updateScore();
                        break;
                    }
                }
            }

            for (let i = particles.length - 1; i >= 0; i--){
                particles[i].x += particles[i].speedX;
                particles[i].y += particles[i].speedY;
                particles[i].life--;
                if (particles[i].life <= 0) particles.splice(i,1);
            }
        }

        function draw(){
            ctx.fillStyle = '#0a0a2a';
            ctx.fillRect(0,0,canvas.width,canvas.height);

            // stars
            ctx.fillStyle = 'white';
            for(let i=0;i<100;i++){
                const x = Math.random()*canvas.width;
                const y = Math.random()*canvas.height;
                const size = Math.random()*2;
                ctx.fillRect(x,y,size,size);
            }

            // player
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2, player.y);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.closePath();
            ctx.fill();

            // bullets
            ctx.fillStyle = '#ff6b6b';
            for (const bullet of bullets) ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);

            // asteroids
            for (const asteroid of asteroids){
                ctx.fillStyle = '#8a8a8a';
                ctx.beginPath();
                ctx.arc(asteroid.x + asteroid.width/2, asteroid.y + asteroid.height/2, asteroid.width/2, 0, Math.PI*2);
                ctx.fill();
                ctx.fillStyle = '#6a6a6a';
                ctx.beginPath();
                ctx.arc(asteroid.x + asteroid.width/3, asteroid.y + asteroid.height/3, asteroid.width/6, 0, Math.PI*2);
                ctx.fill();
            }

            // particles
            for (const particle of particles){
                ctx.fillStyle = particle.color;
                ctx.globalAlpha = particle.life / 30;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }

        function gameLoop(){
            if (!gameActive) return;
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Draw initial screen once
        draw();

        // --- Auto-start behavior when ?autostart=1 is present ---
        // Example instant-play URL:
        // https://Atuhuriire-Stuart.github.io/Game/?autostart=1
        function tryAutoStart(){
            const params = new URLSearchParams(window.location.search);
            if (params.get('autostart') === '1') {
                // Start the game visually immediately
                startGame();

                // Add a one-time pointerdown handler to supply a user gesture (helps unlock keyboard/audio on some mobile browsers)
                document.body.addEventListener('pointerdown', function onFirstInteraction() {
                    document.body.removeEventListener('pointerdown', onFirstInteraction);
                }, { once: true });
            }
        }

        window.addEventListener('DOMContentLoaded', tryAutoStart);
    </script>
</body>
</html>
